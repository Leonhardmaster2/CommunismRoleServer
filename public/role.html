<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Comrade - Kulturrevolution</title>
  <link rel="stylesheet" href="/style.css">
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <div class="role-page">
    <div class="container" id="gameContainer">
      <div class="role-header">
        <div class="flag-icon">üö©</div>
        <h1 class="title">Comrade <span id="playerName" class="player-name-display"></span></h1>
        <div class="role-badge">Revolutionary</div>
      </div>

      <div class="task-container">
        <div id="status" class="status">
          <div class="loading-dots">
            <span></span>
            <span></span>
            <span></span>
          </div>
          <p>Waiting for your secret task...</p>
        </div>
        <div id="taskCard" class="task-card hidden">
          <div class="task-type-badge" id="taskTypeBadge"></div>
          <div class="task-content" id="task"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Get player ID from URL
    const pathParts = window.location.pathname.split('/');
    const playerID = pathParts[pathParts.length - 1];

    let playerName = '';

    // Connect to Socket.IO
    const socket = io();

    // Register with server
    socket.on('connect', () => {
      console.log('Connected to server');
      socket.emit('register', playerID);
    });

    // Handle player info
    socket.on('playerInfo', (info) => {
      playerName = info.name;
      document.getElementById('playerName').textContent = info.name;
    });

    // Handle new task
    socket.on('newTask', (data) => {
      const statusEl = document.getElementById('status');
      const taskCard = document.getElementById('taskCard');
      const taskEl = document.getElementById('task');
      const typeBadge = document.getElementById('taskTypeBadge');

      // Hide loading status
      statusEl.classList.add('hidden');

      // Set task content
      taskEl.textContent = data.task;

      // Set task type badge
      if (data.type === 'hunter') {
        typeBadge.textContent = 'üéØ HUNTER';
        typeBadge.className = 'task-type-badge hunter';
        taskCard.className = 'task-card hunter';
      } else {
        typeBadge.textContent = 'üé≠ TARGET';
        typeBadge.className = 'task-type-badge hunted';
        taskCard.className = 'task-card hunted';
      }

      // Show task card with animation
      taskCard.classList.remove('hidden');
      setTimeout(() => {
        taskCard.classList.add('show');
      }, 10);
    });

    // Handle elimination
    socket.on('dead', () => {
      const container = document.getElementById('gameContainer');
      container.innerHTML = `
        <div class="eliminated">
          <div class="skull-animation">‚ò†Ô∏è</div>
          <h2>You have been eliminated</h2>
          <p>Your role in the revolution has come to an end.</p>
          <div class="eliminated-name">${playerName}</div>
        </div>
      `;
    });

    // Handle system messages
    socket.on('systemMessage', (message) => {
      showNotification(message);
    });

    // Handle game reset
    socket.on('gameReset', () => {
      const statusEl = document.getElementById('status');
      const taskCard = document.getElementById('taskCard');

      statusEl.classList.remove('hidden');
      statusEl.innerHTML = `
        <div class="loading-dots">
          <span></span>
          <span></span>
          <span></span>
        </div>
        <p>Game has been reset. Waiting for new instructions...</p>
      `;
      taskCard.classList.add('hidden');
      taskCard.classList.remove('show');
    });

    // Show notification
    function showNotification(message) {
      const notification = document.createElement('div');
      notification.className = 'notification';
      notification.innerHTML = `
        <div class="notification-icon">üì¢</div>
        <div class="notification-text">${message}</div>
      `;
      document.body.appendChild(notification);

      setTimeout(() => {
        notification.classList.add('show');
      }, 10);

      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
          notification.remove();
        }, 300);
      }, 5000);
    }

    // Handle connection errors
    socket.on('connect_error', (error) => {
      console.error('Connection error:', error);
      showNotification('Connection error. Please check your connection.');
    });
  </script>
</body>
</html>
